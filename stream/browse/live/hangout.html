<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stream | Lance Sfp Live Hangout</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../styles.css">
  <link rel="stylesheet" href="../browse.css">
  <link rel="stylesheet" href="player.css">
</head>

<body>
  <div class="video-player" id="video-player">
    <!-- Video Container -->
    <div class="video-player__container">
      <video class="video-player__video" id="video-element" playsinline autoplay>
        <source src="https://e7caae203136.entrypoint.cloud.wowza.com/app-mH0vX4r3/ngrp:e7dd6d88_all/playlist.m3u8" type="application/x-mpegURL">
        Your browser does not support the video tag.
      </video>

      <!-- Loading Spinner -->
      <div class="video-player__loading" id="loading-spinner">
        <div class="video-player__loading-spinner"></div>
      </div>

      <!-- Custom Subtitle Overlay -->
      <div class="video-player__subtitle-overlay" id="subtitle-overlay"></div>

      <!-- Controls Overlay -->
      <div class="video-player__controls" id="controls">
        <!-- Top Controls Bar -->
        <div class="video-player__top-controls">
          <button class="video-player__back-btn" id="back-btn" aria-label="Back to Browse">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>
        </div>

        <!-- Bottom Controls Bar -->
        <div class="video-player__bottom-controls">
          <div class="video-player__progress-container">
            <div class="video-player__progress-bar" id="progress-bar">
              <div class="video-player__progress-filled" id="progress-filled"></div>
              <div class="video-player__progress-handle" id="progress-handle"></div>
              <div class="video-player__progress-timestamp" id="progress-timestamp"></div>
              <div class="video-player__progress-thumbnail" id="progress-thumbnail">
                <img id="progress-thumbnail-img" src="" alt="Preview">
              </div>
            </div>
          </div>

          <div class="video-player__control-buttons">
            <div class="video-player__left-controls">
              <button class="video-player__play-btn" id="play-btn" aria-label="Play/Pause">
                <svg class="play-icon" viewBox="0 0 24 24" fill="currentColor">
                  <polygon points="5 3 19 12 5 21 5 3"></polygon>
                </svg>
                <svg class="pause-icon" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
                  <rect x="6" y="4" width="4" height="16"></rect>
                  <rect x="14" y="4" width="4" height="16"></rect>
                </svg>
              </button>

              <button class="video-player__volume-btn" id="volume-btn" aria-label="Volume">
                <svg class="volume-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                  <path class="volume-waves" d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                </svg>
                <svg class="volume-muted-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                  style="display: none;">
                  <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                  <line x1="23" y1="9" x2="17" y2="15"></line>
                  <line x1="17" y1="9" x2="23" y2="15"></line>
                </svg>
                <div class="video-player__volume-slider-container">
                  <div class="video-player__volume-slider-track">
                    <div class="video-player__volume-slider-filled" id="volume-slider-filled"></div>
                    <input type="range" class="video-player__volume-slider" id="volume-slider" min="0" max="100"
                      value="100" aria-label="Volume">
                  </div>
                </div>
              </button>
            </div>

            <div class="video-player__episode-info" id="episode-info">
              <span class="video-player__episode-info-show" id="episode-info-show">Lance Sfp Live Hangout</span>
              <span class="video-player__episode-info-episode" id="episode-info-episode"></span>
            </div>

            <div class="video-player__right-controls">
              <button class="video-player__fullscreen-btn" id="fullscreen-btn" aria-label="Fullscreen">
                <svg class="fullscreen-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path
                    d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3">
                  </path>
                </svg>
                <svg class="fullscreen-exit-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                  style="display: none;">
                  <path d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                </svg>
              </button>
              <div class="video-player__time-display" id="time-display">LIVE</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Panel -->
      <div class="video-player__settings-panel" id="settings-panel">
        <div class="video-player__settings-header">
          <h3>Audio</h3>
          <button class="video-player__settings-close" id="settings-close" aria-label="Close Settings">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="video-player__settings-content">
          <div class="video-player__settings-section">
            <h4>Audio</h4>
            <div class="video-player__settings-options" id="audio-tracks"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <script src="../../auth.js"></script>
  <script>
    // Simplified player for this specific stream
    class LiveStreamPlayer {
      constructor() {
        this.video = document.getElementById('video-element');
        this.container = document.getElementById('video-player');
        this.controls = document.getElementById('controls');
        this.loadingSpinner = document.getElementById('loading-spinner');
        this.subtitleOverlay = document.getElementById('subtitle-overlay');
        this.settingsPanel = document.getElementById('settings-panel');

        // Controls
        this.playBtn = document.getElementById('play-btn');
        this.volumeBtn = document.getElementById('volume-btn');
        this.volumeSlider = document.getElementById('volume-slider');
        this.volumeSliderFilled = document.getElementById('volume-slider-filled');
        this.progressBar = document.getElementById('progress-bar');
        this.progressFilled = document.getElementById('progress-filled');
        this.progressHandle = document.getElementById('progress-handle');
        this.progressTimestamp = document.getElementById('progress-timestamp');
        this.progressThumbnail = document.getElementById('progress-thumbnail');
        this.progressThumbnailImg = document.getElementById('progress-thumbnail-img');
        this.timeDisplay = document.getElementById('time-display');
        this.fullscreenBtn = document.getElementById('fullscreen-btn');
        this.backBtn = document.getElementById('back-btn');
        this.settingsBtn = document.getElementById('settings-btn');
        this.settingsClose = document.getElementById('settings-close');
        this.episodeInfoShow = document.getElementById('episode-info-show');
        this.episodeInfoEpisode = document.getElementById('episode-info-episode');

        // State
        this.isPlaying = false;
        this.isFullscreen = false;
        this.hls = null;
        this.currentAudioTrack = null;
        this.audioTracksContainer = document.getElementById('audio-tracks');
        this.controlsTimeout = null;
        this.isAdjustingVolume = false;
        this.autoplayJustStarted = false;

        // Initialize
        this.init();
      }

      async init() {
        const streamUrl = 'https://e7caae203136.entrypoint.cloud.wowza.com/app-mH0vX4r3/ngrp:e7dd6d88_all/playlist.m3u8';
        
        // Set channel name
        if (this.episodeInfoShow) {
          this.episodeInfoShow.textContent = 'Lance Sfp Live Hangout';
        }

        // Load HLS stream
        this.loadM3U8(streamUrl);

        // Load audio tracks
        this.loadTracks();

        // Set up event listeners
        this.setupEventListeners();

        // Auto-hide controls
        this.setupControlsAutoHide();

        // Setup loading spinner
        this.setupLoadingSpinner();

        // Initialize volume slider filled portion
        this.updateVolumeSliderFilled();
      }

      setupLoadingSpinner() {
        this.video.addEventListener('loadstart', () => {
          this.showLoadingSpinner();
        });

        this.video.addEventListener('waiting', () => {
          this.showLoadingSpinner();
        });

        this.video.addEventListener('loadeddata', () => {
          this.hideLoadingSpinner();
        });

        this.video.addEventListener('canplay', () => {
          this.hideLoadingSpinner();
        });

        this.video.addEventListener('playing', () => {
          this.hideLoadingSpinner();
        });

        this.video.addEventListener('error', () => {
          this.hideLoadingSpinner();
        });
      }

      showLoadingSpinner() {
        if (this.loadingSpinner) {
          this.loadingSpinner.classList.add('active');
        }
      }

      hideLoadingSpinner() {
        if (this.loadingSpinner) {
          this.loadingSpinner.classList.remove('active');
        }
      }

      loadM3U8(m3u8Url) {
        this.showLoadingSpinner();

        if (typeof Hls !== 'undefined' && Hls.isSupported()) {
          const hls = new Hls({
            enableWorker: true,
            lowLatencyMode: true,
            backBufferLength: 30
          });
          hls.loadSource(m3u8Url);
          hls.attachMedia(this.video);

          hls.on(Hls.Events.MANIFEST_PARSED, () => {
            console.log('HLS manifest parsed, ready to play');
            this.setupAudioTracks();
            this.selectFilipinoAudioTrack();
          });

          hls.on(Hls.Events.FRAG_LOADING, () => {
            if (this.video.readyState < 3) {
              this.showLoadingSpinner();
            }
          });

          hls.on(Hls.Events.FRAG_LOADED, () => {
            if (this.video.readyState >= 3 && !this.video.paused) {
              this.hideLoadingSpinner();
            }
          });

          hls.on(Hls.Events.ERROR, (event, data) => {
            console.error('HLS error:', data);
            this.hideLoadingSpinner();
            if (data.fatal) {
              switch (data.type) {
                case Hls.ErrorTypes.NETWORK_ERROR:
                  console.log('Fatal network error, try to recover');
                  hls.startLoad();
                  break;
                case Hls.ErrorTypes.MEDIA_ERROR:
                  console.log('Fatal media error, try to recover');
                  hls.recoverMediaError();
                  break;
                default:
                  console.log('Fatal error, cannot recover');
                  hls.destroy();
                  break;
              }
            }
          });

          this.hls = hls;
        } else if (this.video.canPlayType('application/vnd.apple.mpegurl')) {
          this.video.src = m3u8Url;
        } else {
          console.error('HLS not supported in this browser.');
        }
      }

      selectFilipinoAudioTrack() {
        if (!this.hls || !this.hls.audioTracks || this.hls.audioTracks.length === 0) {
          return;
        }

        const filipinoTrackIndex = this.hls.audioTracks.findIndex(track => {
          const lang = (track.lang || '').toLowerCase();
          const name = (track.name || '').toLowerCase();
          return lang.includes('fil') || lang.includes('tag') || lang.includes('tl') ||
            name.includes('filipino') || name.includes('tagalog');
        });

        if (filipinoTrackIndex >= 0) {
          this.hls.audioTrack = filipinoTrackIndex;
          this.currentAudioTrack = 'fil';
          console.log('Filipino audio track selected');
        } else if (this.hls.audioTracks.length > 0) {
          this.hls.audioTrack = 0;
          console.log('No Filipino audio track found, using default track');
        }
      }

      setupEventListeners() {
        this.video.addEventListener('loadedmetadata', () => {
          this.setupAudioTracks();
        });

        this.video.addEventListener('timeupdate', () => {
          this.updateProgress();
        });

        this.video.addEventListener('play', () => {
          this.isPlaying = true;
          this.updatePlayButton();
        });

        this.video.addEventListener('pause', () => {
          this.isPlaying = false;
          this.updatePlayButton();
        });

        this.video.addEventListener('volumechange', () => {
          this.updateVolumeButton();
          this.updateVolumeSliderFilled();
        });

        const enableSoundOnInteraction = () => {
          if (this.video.muted && this.video.readyState >= 2) {
            this.video.muted = false;
            this.updateVolumeButton();
          }
        };

        const interactionEvents = ['click', 'touchstart', 'keydown'];
        const enableSoundOnce = () => {
          enableSoundOnInteraction();
          interactionEvents.forEach(event => {
            document.removeEventListener(event, enableSoundOnce);
          });
        };
        interactionEvents.forEach(event => {
          document.addEventListener(event, enableSoundOnce, { once: true });
        });

        this.playBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          enableSoundOnInteraction();
          this.togglePlay();
        });

        const handleMainClick = (e) => {
          const interactiveElements = ['BUTTON', 'INPUT', 'A', 'SVG', 'PATH', 'IMG'];
          if (interactiveElements.includes(e.target.tagName) || e.target.closest('button')) {
            return;
          }
          enableSoundOnInteraction();
          this.togglePlay();
        };

        if (this.controls) {
          this.controls.addEventListener('click', handleMainClick);
        }
        this.video.addEventListener('click', handleMainClick);

        this.volumeBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          this.toggleMute();
        });

        this.volumeSlider.addEventListener('mousedown', () => {
          this.isAdjustingVolume = true;
        });

        this.volumeSlider.addEventListener('input', (e) => {
          const newVolume = e.target.value / 100;
          this.video.volume = newVolume;
          if (newVolume > 0 && this.video.muted) {
            this.video.muted = false;
          }
          this.updateVolumeSliderFilled();
        });

        const handleVolumeSliderRelease = () => {
          this.isAdjustingVolume = false;
          setTimeout(() => {
            if (this.video.volume > 0 && this.video.muted) {
              this.video.muted = false;
            }
            this.updateVolumeButton();
          }, 50);
        };

        this.volumeSlider.addEventListener('mouseup', handleVolumeSliderRelease);
        this.volumeSlider.addEventListener('change', handleVolumeSliderRelease);
        this.volumeSlider.addEventListener('touchstart', () => {
          this.isAdjustingVolume = true;
        });
        this.volumeSlider.addEventListener('touchend', handleVolumeSliderRelease);

        if (this.progressBar) {
          this.progressBar.addEventListener('mousemove', (e) => {
            const rect = this.progressBar.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            if (this.progressHandle) {
              this.progressHandle.style.left = `${percent * 100}%`;
            }
            if (this.progressTimestamp) {
              this.progressTimestamp.textContent = 'LIVE';
              this.progressTimestamp.style.left = `${percent * 100}%`;
            }
          });

          this.progressBar.addEventListener('mouseenter', () => {
            if (this.progressTimestamp) {
              this.progressTimestamp.style.opacity = '1';
              this.progressTimestamp.style.visibility = 'visible';
            }
            if (this.progressHandle) {
              this.progressHandle.style.opacity = '1';
            }
          });

          this.progressBar.addEventListener('mouseleave', () => {
            if (this.progressTimestamp) {
              this.progressTimestamp.style.opacity = '0';
              this.progressTimestamp.style.visibility = 'hidden';
            }
            if (this.progressHandle) {
              this.progressHandle.style.opacity = '0';
            }
          });

          this.progressBar.style.cursor = 'default';
        }

        this.fullscreenBtn.addEventListener('click', () => this.toggleFullscreen());

        if (this.settingsBtn) {
          this.settingsBtn.addEventListener('click', () => this.toggleSettings());
        }
        if (this.settingsClose) {
          this.settingsClose.addEventListener('click', () => this.toggleSettings());
        }

        this.backBtn.addEventListener('click', () => {
          if (this.isFullscreen) {
            this.exitFullscreen();
          } else {
            window.location.href = '../browse/';
          }
        });

        this.setupKeyboardShortcuts();
      }

      setupControlsAutoHide() {
        const HIDE_DELAY = 3000;

        const showControlsAndReset = () => {
          clearTimeout(this.controlsTimeout);
          this.showControls();

          this.controlsTimeout = setTimeout(() => {
            if (!this.video.paused) {
              this.hideControls();
            }
          }, HIDE_DELAY);
        };

        this.container.addEventListener('mousemove', showControlsAndReset);
        this.container.addEventListener('click', showControlsAndReset);
        this.container.addEventListener('touchstart', showControlsAndReset);

        showControlsAndReset();

        this.video.addEventListener('play', () => {
          showControlsAndReset();
        });

        this.video.addEventListener('pause', () => {
          clearTimeout(this.controlsTimeout);
          this.showControls();
        });
      }

      showControls() {
        this.controls.classList.add('show');
      }

      hideControls() {
        if (this.video.paused) return;
        this.controls.classList.remove('show');
      }

      togglePlay() {
        if (this.video.paused) {
          this.video.play();
        } else {
          this.video.pause();
        }
      }

      updateProgress() {
        if (this.video.buffered.length > 0) {
          const bufferedEnd = this.video.buffered.end(this.video.buffered.length - 1);
          const bufferedStart = this.video.buffered.start(0);
          const bufferedRange = bufferedEnd - bufferedStart;
          
          if (bufferedRange > 0) {
            const bufferPercent = Math.min(100, (bufferedRange / 30) * 100);
            if (this.progressFilled) {
              this.progressFilled.style.width = `${bufferPercent}%`;
            }
            if (this.progressHandle) {
              this.progressHandle.style.left = `${bufferPercent}%`;
            }
          }
        }
        
        if (this.timeDisplay) {
          this.timeDisplay.textContent = 'LIVE';
        }
      }

      updatePlayButton() {
        const playIcon = this.playBtn.querySelector('.play-icon');
        const pauseIcon = this.playBtn.querySelector('.pause-icon');

        if (this.isPlaying) {
          playIcon.style.display = 'none';
          pauseIcon.style.display = 'block';
        } else {
          playIcon.style.display = 'block';
          pauseIcon.style.display = 'none';
        }
      }

      toggleMute() {
        this.video.muted = !this.video.muted;
        if (!this.video.muted) {
          this.volumeSlider.value = this.video.volume * 100;
        }
        this.updateVolumeButton();
      }

      updateVolumeButton() {
        if (this.video.muted) {
          this.volumeBtn.classList.add('muted');
          this.volumeBtn.querySelector('.volume-icon').style.display = 'none';
          this.volumeBtn.querySelector('.volume-muted-icon').style.display = 'block';
        } else {
          this.volumeBtn.classList.remove('muted');
          this.volumeBtn.querySelector('.volume-icon').style.display = 'block';
          this.volumeBtn.querySelector('.volume-muted-icon').style.display = 'none';
        }
        if (this.volumeSlider) {
          this.volumeSlider.value = this.video.volume * 100;
          this.updateVolumeSliderFilled();
        }
      }

      updateVolumeSliderFilled() {
        if (this.volumeSliderFilled && this.volumeSlider) {
          const percent = this.volumeSlider.value;
          this.volumeSliderFilled.style.width = `${percent}%`;
        }
      }

      toggleFullscreen() {
        if (!this.isFullscreen) {
          this.enterFullscreen();
        } else {
          this.exitFullscreen();
        }
      }

      enterFullscreen() {
        if (this.container.requestFullscreen) {
          this.container.requestFullscreen();
        } else if (this.container.webkitRequestFullscreen) {
          this.container.webkitRequestFullscreen();
        } else if (this.container.mozRequestFullScreen) {
          this.container.mozRequestFullScreen();
        } else if (this.container.msRequestFullscreen) {
          this.container.msRequestFullscreen();
        }
      }

      exitFullscreen() {
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.mozCancelFullScreen) {
          document.mozCancelFullScreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
      }

      setupFullscreenListeners() {
        document.addEventListener('fullscreenchange', () => {
          this.isFullscreen = !!document.fullscreenElement;
          this.updateFullscreenButton();
        });

        document.addEventListener('webkitfullscreenchange', () => {
          this.isFullscreen = !!document.webkitFullscreenElement;
          this.updateFullscreenButton();
        });

        document.addEventListener('mozfullscreenchange', () => {
          this.isFullscreen = !!document.mozFullScreenElement;
          this.updateFullscreenButton();
        });

        document.addEventListener('MSFullscreenChange', () => {
          this.isFullscreen = !!document.msFullscreenElement;
          this.updateFullscreenButton();
        });
      }

      updateFullscreenButton() {
        const fullscreenIcon = this.fullscreenBtn.querySelector('.fullscreen-icon');
        const fullscreenExitIcon = this.fullscreenBtn.querySelector('.fullscreen-exit-icon');

        if (this.isFullscreen) {
          fullscreenIcon.style.display = 'none';
          fullscreenExitIcon.style.display = 'block';
        } else {
          fullscreenIcon.style.display = 'block';
          fullscreenExitIcon.style.display = 'none';
        }
      }

      toggleSettings() {
        this.settingsPanel.classList.toggle('show');
      }

      setupKeyboardShortcuts() {
        document.addEventListener('keydown', (e) => {
          if (e.target.tagName === 'INPUT') return;

          switch (e.key) {
            case ' ':
            case 'k':
              e.preventDefault();
              this.togglePlay();
              break;
            case 'ArrowUp':
              e.preventDefault();
              this.video.volume = Math.min(1, this.video.volume + 0.1);
              this.volumeSlider.value = this.video.volume * 100;
              this.updateVolumeSliderFilled();
              break;
            case 'ArrowDown':
              e.preventDefault();
              this.video.volume = Math.max(0, this.video.volume - 0.1);
              this.volumeSlider.value = this.video.volume * 100;
              this.updateVolumeSliderFilled();
              break;
            case 'm':
              e.preventDefault();
              this.toggleMute();
              break;
            case 'f':
              e.preventDefault();
              this.toggleFullscreen();
              break;
            case 'Escape':
              if (this.settingsPanel.classList.contains('show')) {
                this.toggleSettings();
              } else if (this.isFullscreen) {
                this.exitFullscreen();
              }
              break;
          }
        });
      }

      loadTracks() {
        this.setupDefaultTracks();
      }

      setupAudioTracks() {
        if (!this.audioTracksContainer) return;

        this.audioTracksContainer.innerHTML = '';

        const tracks = [
          { id: 'fil', label: 'Filipino', lang: 'fil' }
        ];

        tracks.forEach(track => {
          const option = document.createElement('button');
          option.className = 'video-player__settings-option';
          option.dataset.track = track.id;
          option.dataset.lang = track.lang;

          if (track.id === 'fil') {
            option.classList.add('active');
          }

          option.innerHTML = `
            <span>${track.label}</span>
            <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
          `;

          option.addEventListener('click', () => {
            this.selectAudioTrack(track.id);

            document.querySelectorAll('#audio-tracks .video-player__settings-option').forEach(opt => {
              opt.classList.remove('active');
            });
            option.classList.add('active');
          });

          this.audioTracksContainer.appendChild(option);
        });
      }

      selectAudioTrack(trackId) {
        this.currentAudioTrack = trackId;

        if (this.hls && this.hls.audioTracks && this.hls.audioTracks.length > 0) {
          if (trackId === 'fil') {
            const filipinoTrackIndex = this.hls.audioTracks.findIndex(track => {
              const lang = (track.lang || '').toLowerCase();
              const name = (track.name || '').toLowerCase();
              return lang.includes('fil') || lang.includes('tag') || lang.includes('tl') ||
                name.includes('filipino') || name.includes('tagalog');
            });

            if (filipinoTrackIndex >= 0) {
              this.hls.audioTrack = filipinoTrackIndex;
              console.log('Switched to Filipino audio track');
            } else {
              this.hls.audioTrack = 0;
            }
          } else {
            this.hls.audioTrack = 0;
          }
        }
      }

      setupDefaultTracks() {
        this.currentAudioTrack = 'fil';
      }
    }

    // Initialize player when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      const player = new LiveStreamPlayer();
      player.setupFullscreenListeners();

      // Make player globally accessible for debugging
      window.liveStreamPlayer = player;
    });
  </script>
</body>

</html>

